(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56433,e=>{"use strict";var t=e.i(48277),a=e.i(30668),r=e.i(61305),s=e.i(91489),l=e.i(54976),d=e.i(18074),d=d,n=e.i(25673),o=e.i(56199),i=e.i(35884);let c=(0,i.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),u=(0,i.default)("folder-up",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]]),h=(0,i.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),x=(0,i.default)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),m=(0,i.default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var b=e.i(80380);let g=(0,i.default)("panels-top-left",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);var p=e.i(4645);let f=(0,i.default)("redo-2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]),k=(0,i.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var v=e.i(20175),v=v;let y=(0,i.default)("shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]),j=(0,i.default)("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),w=(0,i.default)("undo-2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),N=(0,i.default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),C=(0,i.default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var S=e.i(24366),S=S;let M=(0,i.default)("magnet",[["path",{d:"m12 15 4 4",key:"lnac28"}],["path",{d:"M2.352 10.648a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.029-6.029a1 1 0 1 1 3 3l-6.029 6.029a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.365-6.367A1 1 0 0 0 8.716 4.282z",key:"nlhkjb"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}]]),U=(0,i.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),I=(0,i.default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var F=e.i(49449),P=e.i(72671),T=e.i(42588),z=e.i(96086),B=e.i(85205),E=e.i(2470),D=e.i(75680),R=e.i(96134),W=e.i(26145),A=e.i(9166),L=e.i(97366),H=e.i(17929),$=e.i(11432),_=e.i(11126),O=e.i(7950),V=e.i(74327),q="Tabs",[G,J]=(0,A.createContextScope)(q,[L.createRovingFocusGroupScope]),K=(0,L.createRovingFocusGroupScope)(),[Q,X]=G(q),Y=a.forwardRef((e,a)=>{let{__scopeTabs:r,value:s,onValueChange:l,defaultValue:d,orientation:n="horizontal",dir:o,activationMode:i="automatic",...c}=e,u=(0,_.useDirection)(o),[h,x]=(0,O.useControllableState)({prop:s,onChange:l,defaultProp:d??"",caller:q});return(0,t.jsx)(Q,{scope:r,baseId:(0,V.useId)(),value:h,onValueChange:x,orientation:n,dir:u,activationMode:i,children:(0,t.jsx)($.Primitive.div,{dir:u,"data-orientation":n,...c,ref:a})})});Y.displayName=q;var Z="TabsList",ee=a.forwardRef((e,a)=>{let{__scopeTabs:r,loop:s=!0,...l}=e,d=X(Z,r),n=K(r);return(0,t.jsx)(L.Root,{asChild:!0,...n,orientation:d.orientation,dir:d.dir,loop:s,children:(0,t.jsx)($.Primitive.div,{role:"tablist","aria-orientation":d.orientation,...l,ref:a})})});ee.displayName=Z;var et="TabsTrigger",ea=a.forwardRef((e,a)=>{let{__scopeTabs:r,value:s,disabled:l=!1,...d}=e,n=X(et,r),o=K(r),i=el(n.baseId,s),c=ed(n.baseId,s),u=s===n.value;return(0,t.jsx)(L.Item,{asChild:!0,...o,focusable:!l,active:u,children:(0,t.jsx)($.Primitive.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:i,...d,ref:a,onMouseDown:(0,W.composeEventHandlers)(e.onMouseDown,e=>{l||0!==e.button||!1!==e.ctrlKey?e.preventDefault():n.onValueChange(s)}),onKeyDown:(0,W.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&n.onValueChange(s)}),onFocus:(0,W.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==n.activationMode;u||l||!e||n.onValueChange(s)})})})});ea.displayName=et;var er="TabsContent",es=a.forwardRef((e,r)=>{let{__scopeTabs:s,value:l,forceMount:d,children:n,...o}=e,i=X(er,s),c=el(i.baseId,l),u=ed(i.baseId,l),h=l===i.value,x=a.useRef(h);return a.useEffect(()=>{let e=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(H.Presence,{present:d||h,children:({present:a})=>(0,t.jsx)($.Primitive.div,{"data-state":h?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":c,hidden:!a,id:u,tabIndex:0,...o,ref:r,style:{...e.style,animationDuration:x.current?"0s":void 0},children:a&&n})})});function el(e,t){return`${e}-trigger-${t}`}function ed(e,t){return`${e}-content-${t}`}es.displayName=er;var en=e.i(41428);function eo({className:e,...a}){return(0,t.jsx)(Y,{"data-slot":"tabs",className:(0,en.cn)("flex flex-col gap-2",e),...a})}function ei({className:e,...a}){return(0,t.jsx)(ee,{"data-slot":"tabs-list",className:(0,en.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",e),...a})}function ec({className:e,...a}){return(0,t.jsx)(ea,{"data-slot":"tabs-trigger",className:(0,en.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...a})}function eu({className:e,...a}){return(0,t.jsx)(es,{"data-slot":"tabs-content",className:(0,en.cn)("flex-1 outline-none",e),...a})}var eh=e.i(5647),ex=e.i(44363),em=e.i(35369);let eb=(0,i.default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),eg=[{id:"instagram-post-square",label:"Instagram Post (1080 × 1080)",orientation:"square",width:1080,height:1080,description:"Versatile square post size recommended for Instagram feed, Facebook, and Pinterest squares."},{id:"instagram-story",label:"Instagram Story / Reels (1080 × 1920)",orientation:"story",width:1080,height:1920,description:"Full-portrait canvas ideal for Stories, Reels, TikTok, and YouTube Shorts."},{id:"facebook-landscape",label:"Facebook Landscape (1200 × 630)",orientation:"wide",width:1200,height:630,description:"Classic Facebook link preview dimensions that also work for Twitter and LinkedIn landscape posts."},{id:"linkedin-post",label:"LinkedIn Post (1200 × 627)",orientation:"wide",width:1200,height:627,description:"Optimised for LinkedIn feed posts and article previews."},{id:"twitter-post",label:"X / Twitter Post (1600 × 900)",orientation:"wide",width:1600,height:900,description:"High-resolution 16:9 canvas tailored for X / Twitter shares and YouTube thumbnails."},{id:"pinterest-pin",label:"Pinterest Pin (1000 × 1500)",orientation:"story",width:1e3,height:1500,description:"Tall 2:3 ratio pin that also suits blog graphics and infographics."}],ep=eg[0]?.id??"instagram-post-square",ef=e=>e?eg.find(t=>t.id===e):void 0,ek=(e,t)=>`${e} \xd7 ${t}`,ev=e=>{let t=(e=>{let{canvasPreset:t,canvasWidth:a,canvasHeight:r,orientation:s}=e,l=ef(t??void 0);if(l)return l;if(a&&r){let e=eg.find(e=>e.width===a&&e.height===r);if(e)return e}if(s){let e=eg.find(e=>e.orientation===s);if(e)return e}return eg[0]})(e);return{width:e.canvasWidth??t?.width??eg[0].width,height:e.canvasHeight??t?.height??eg[0].height,preset:t}},ey=({template:e,onEdit:a,onUse:r,onDelete:s,isDeleting:l})=>{let d=ev({canvasPreset:e.canvasPreset,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,orientation:e.orientation}),n=d.preset?.label.split(" (")[0]??e.orientation.toUpperCase(),o=ek(d.width,d.height),i=e.emotionFit[0];return(0,t.jsxs)(D.Card,{className:"overflow-hidden border-slate-200 shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-800",children:[(0,t.jsxs)(D.CardHeader,{className:"space-y-2 bg-slate-50 dark:bg-slate-900/40",children:[(0,t.jsxs)(D.CardTitle,{className:"flex items-start justify-between gap-2 text-base",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{children:e.name}),e.tags.length?(0,t.jsx)(D.CardDescription,{className:"flex flex-wrap gap-2 text-xs uppercase tracking-wide text-slate-500",children:e.tags.map(e=>(0,t.jsx)("span",{className:"rounded-full bg-slate-200 px-2 py-0.5 dark:bg-slate-800",children:e},e))}):null]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,t.jsx)(ex.EmotionBadge,{emotion:i}):null,s?(0,t.jsxs)(em.DropdownMenu,{children:[(0,t.jsx)(em.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full text-slate-500 hover:bg-slate-200 dark:text-slate-300 dark:hover:bg-slate-800",disabled:l,children:(0,t.jsx)(eb,{className:"h-4 w-4"})})}),(0,t.jsx)(em.DropdownMenuContent,{align:"end",className:"w-44",children:(0,t.jsxs)(em.DropdownMenuItem,{className:"flex items-center gap-2 text-red-600 focus:text-red-600",onClick:()=>{l||s(e)},children:[(0,t.jsx)(F.Trash2,{className:"h-4 w-4"}),"Delete template"]})})]}):null]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-500 pt-1",children:[(0,t.jsx)("span",{className:"rounded-full bg-slate-200 px-2 py-0.5 font-medium uppercase tracking-wide dark:bg-slate-800",children:n}),(0,t.jsx)("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 font-medium dark:bg-slate-900",children:o})]})]}),(0,t.jsxs)(D.CardContent,{className:"space-y-4 p-4",children:[(0,t.jsx)("div",{className:"relative h-40 w-full overflow-hidden rounded-lg border border-slate-200 dark:border-slate-800",style:{background:e.backgroundColor??"#0f172a"},children:e.backgroundUrl?(0,t.jsx)(T.default,{alt:e.name,src:e.backgroundUrl,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw"}):(0,t.jsx)("div",{className:"grid h-full place-items-center text-sm text-slate-100",children:e.backgroundColor?"Background color applied":"No background uploaded"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,t.jsx)(B.Button,{variant:"outline",className:"flex-1",onClick:()=>a(e),children:"Edit"}),r&&(0,t.jsx)(B.Button,{className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:()=>r(e),children:"Use Template"})]}),l?(0,t.jsx)("p",{className:"text-center text-xs text-slate-500",children:"Deleting…"}):null]})]})};var ej=e.i(42986),ew=e.i(36470),eN=e.i(1831),eC=e.i(5418),eS=e.i(46471),eM=e.i(42854),eU=e.i(74309),eI=e.i(83194),eF=e.i(3020);let eP=P.z.object({name:P.z.string().min(2),canvasPreset:P.z.string().min(1),tags:P.z.string().optional(),emotionFit:P.z.string().optional()}),eT="#0f172a",ez=async()=>(await eN.api.get(eN.endpoints.business)).data,eB=async e=>e?(await eN.api.get(`${eN.endpoints.template}/${e}`)).data.map(e=>({...e,backgroundUrl:e.backgroundUrl??void 0,backgroundColor:e.backgroundColor??void 0,canvasPreset:e.canvasPreset??void 0,canvasWidth:e.canvasWidth??void 0,canvasHeight:e.canvasHeight??void 0})):[],eE="template-asset-library:v1",eD={library:"Library","template-background":"Background","template-placeholder":"Placeholder",prefill:"Prefill"},eR=e=>"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e)),eW=(e,t)=>JSON.stringify(e)===JSON.stringify(t);function eA(){let[e,i]=(0,a.useState)(null),[P,W]=(0,a.useState)(!1),[A,L]=(0,a.useState)(.35),[H,$]=(0,a.useState)(""),[_,O]=(0,a.useState)("templates"),[V,q]=(0,a.useState)(null),[G,J]=(0,a.useState)(!0),[K,Q]=(0,a.useState)(!0),[X,Y]=(0,a.useState)(!0),[Z,ee]=(0,a.useState)(20),[et,ea]=(0,a.useState)(null),[er,es]=(0,a.useState)([]),[el,ed]=(0,a.useState)(null),eb=(0,a.useRef)(null),eA=(0,a.useRef)(null),eL=(0,a.useRef)([]),eH=(0,a.useRef)([]),e$=(0,a.useRef)(null),[e_,eO]=(0,a.useState)({canUndo:!1,canRedo:!1}),{data:eV=[]}=(0,s.useQuery)({queryKey:eC.queryKeys.business,queryFn:ez,placeholderData:[]}),{activeBusinessId:eq,setActiveBusinessId:eG}=(0,eF.useBusinessStore)(),eJ=eq&&eq!==eF.NEW_BUSINESS_ID?eV.find(e=>e.id===eq)??null:null,eK=(0,a.useMemo)(()=>e?ev({canvasPreset:e.canvasPreset,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,orientation:e.orientation}):null,[e]),eQ=e?e.canvasPreset??eK?.preset?.id??ep:void 0,eX=(0,a.useCallback)(()=>{let e={canUndo:eL.current.length>0,canRedo:eH.current.length>0};eO(t=>t.canUndo===e.canUndo&&t.canRedo===e.canRedo?t:e)},[]),eY=(0,a.useCallback)(()=>{eL.current=[],eH.current=[],e$.current=null,eX()},[eX]),eZ=(0,a.useCallback)((e,t)=>{let a="none";i(r=>{if(!r)return r;let s=eR(r);return(e(s),eW(r,s))?r:(t?.recordHistory===!1?(eH.current=[],a="state-only"):(eL.current.push(eR(r)),eL.current.length>50&&eL.current.shift(),eH.current=[],a="history"),s)}),"none"!==a&&(e$.current=null,eX())},[eX]);(0,a.useEffect)(()=>{try{let e=window.localStorage.getItem(eE);if(!e)return;let t=JSON.parse(e);if(!Array.isArray(t))return;let a=t.filter(e=>!!e&&"string"==typeof e.url).slice(0,60);a.length&&es(a)}catch(e){console.warn("[Templates] Failed to parse asset library from storage",e)}},[]),(0,a.useEffect)(()=>{window.localStorage.setItem(eE,JSON.stringify(er))},[er]),(0,a.useEffect)(()=>()=>{eA.current&&clearTimeout(eA.current)},[]);let e0=(0,a.useCallback)((e,t)=>{q(a=>{if(!t||void 0===t.text&&void 0===t.imageUrl){if(!a||!(e in a))return a;let t={...a};return delete t[e],Object.keys(t).length?t:null}let r={...a??{}};return r[e]={...r[e]??{},...t},r})},[]),e1=(0,a.useCallback)((e,t)=>{e!==t&&q(a=>{if(!a||!(e in a))return a;let r={...a},s=r[e];return delete r[e],r[t]={...r[t]??{},...s},Object.keys(r).length?r:null})},[]),e2=(0,a.useCallback)((e,t)=>{e&&es(a=>{let r=a.filter(e=>!!e&&"string"==typeof e.url),s=r.find(t=>t.url===e);return[{url:e,uploadedAt:Date.now(),name:t??s?.name??null},...r.filter(t=>t.url!==e)].slice(0,60)})},[]),e5=(0,a.useCallback)(async e=>{if(!eJ?.id)return l.toast.error("Select a business before uploading assets."),null;try{let t=new FormData;t.append("background",e);let{url:a}=(await eN.api.post(`${eN.endpoints.template}/${eJ.id}/upload`,t,{headers:{"Content-Type":"multipart/form-data"}})).data;return a}catch(t){let e=t instanceof Error?t.message:"Failed to upload asset";return l.toast.error(e),null}},[eJ?.id]),e6=(0,a.useCallback)(()=>{let e=null;i(t=>{if(!t)return t;let a=eL.current.pop();return a?(eH.current.push(eR(t)),e=a,a):t}),e&&(e$.current=null,eX())},[eX]),e4=(0,a.useCallback)(()=>{let e=null;i(t=>{if(!t)return t;let a=eH.current.pop();return a?(eL.current.push(eR(t)),eL.current.length>50&&eL.current.shift(),e=a,a):t}),e&&(e$.current=null,eX())},[eX]);(0,a.useEffect)(()=>{if(0===eV.length){eq!==eF.NEW_BUSINESS_ID&&eG(eF.NEW_BUSINESS_ID);return}eq&&eq!==eF.NEW_BUSINESS_ID&&eV.some(e=>e.id===eq)||eG(eV[0].id)},[eV,eq,eG]);let{data:e3=[],isLoading:e9,refetch:e8}=(0,s.useQuery)({queryKey:eC.queryKeys.templates(eJ?.id),queryFn:()=>eB(eJ?.id),enabled:!!eJ?.id,placeholderData:[]}),e7=(0,z.useSearchParams)(),te=(0,z.useRouter)(),tt=(0,a.useRef)(!1),ta=(0,a.useRef)(null),tr=eJ?.id??(eq===eF.NEW_BUSINESS_ID?eF.NEW_BUSINESS_ID:""),ts=(e,t)=>{eY();let a=Math.max(.2,Math.min(1,Number((420/ev({canvasPreset:e.canvasPreset,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,orientation:e.orientation}).width).toFixed(2))));i({...e,backgroundUrl:e.backgroundUrl??void 0,backgroundColor:e.backgroundColor??void 0}),L(a),q(t?.prefill??null),ta.current=t?.returnTo??null,W(!0)};(0,a.useEffect)(()=>{P||(eb.current=null,J(!0))},[P]);let tl=(0,eS.useForm)({resolver:(0,eM.zodResolver)(eP),defaultValues:{name:"",canvasPreset:ep,tags:"social, launch",emotionFit:"joy, trust"}}),td=tl.watch("canvasPreset"),tn=(0,a.useMemo)(()=>ef(td)??eg[0],[td]),to=(0,r.useMutation)({mutationFn:async e=>{if(!eJ?.id)throw Error("Select a business first");let t=ef(e.canvasPreset)??eg[0],a=Math.max(48,Math.round(.06*t.width)),r=Math.max(36,Math.round(.065*t.height)),s=Math.max(20,Math.round(.04*t.height)),l=Math.max(24,Math.round(.6*r)),d=Math.max(60,Math.round(.12*t.height)),n=Math.max(220,Math.round(t.width*("story"===t.orientation?.58:"wide"===t.orientation?.36:.42))),o=Math.max(220,Math.round(t.height*("story"===t.orientation?.36:"wide"===t.orientation?.56:.38))),i=(()=>{if("wide"===t.orientation){let e=Math.max(340,Math.round(.42*t.width));return{title:{x:a,y:d,maxWidth:e,align:"left"},subtitle:{x:a,y:d+r+l,maxWidth:e,align:"left"},image:{x:Math.max(a,t.width-n-a),y:Math.round((t.height-o)/2)}}}if("story"===t.orientation){let e=Math.max(360,Math.round(.78*t.width)),a=Math.round((t.width-e)/2);return{title:{x:a,y:d,maxWidth:e,align:"center"},subtitle:{x:a,y:d+r+l,maxWidth:e,align:"center"},image:{x:Math.round((t.width-n)/2),y:Math.round(d+r+s+3*l)}}}let e=Math.max(360,Math.round(.64*t.width)),i=Math.round((t.width-e)/2);return{title:{x:i,y:d,maxWidth:e,align:"center"},subtitle:{x:i,y:d+r+l,maxWidth:e,align:"center"},image:{x:Math.round((t.width-n)/2),y:Math.round(d+r+s+3*l)}}})(),c=Math.min(i.image.y,t.height-o-a),u={name:e.name,orientation:t.orientation,canvasPreset:t.id,canvasWidth:t.width,canvasHeight:t.height,backgroundColor:eT,tags:e.tags?.split(",").map(e=>e.trim())??[],emotionFit:e.emotionFit?.split(",").map(e=>e.trim())??["joy"],placeholders:[{key:"title",type:"text",x:i.title.x,y:i.title.y,fontSize:r,color:"#ffffff",maxWidth:i.title.maxWidth,fontFamily:"Inter",fontWeight:"bold",letterSpacing:0,lineHeight:1.2,opacity:1,rotation:0,locked:!1,align:i.title.align},{key:"subtitle",type:"text",x:i.subtitle.x,y:i.subtitle.y,fontSize:s,color:"#e2e8f0",maxWidth:i.subtitle.maxWidth,fontFamily:"Inter",fontWeight:"normal",letterSpacing:0,lineHeight:1.3,opacity:1,rotation:0,locked:!1,align:i.subtitle.align},{key:"image",type:"image",x:i.image.x,y:c,width:n,height:o,opacity:1,rotation:0,locked:!1}]};return(await eN.api.post(`${eN.endpoints.template}/${eJ.id}`,u)).data},onSuccess:()=>{l.toast.success("Template created"),tl.reset({name:"",canvasPreset:ep,tags:"social, launch",emotionFit:"joy, trust"}),e8()},onError:e=>l.toast.error(e instanceof Error?e.message:"Failed to create template")}),ti=(0,r.useMutation)({mutationFn:async e=>{let t={...e,backgroundUrl:e.backgroundUrl??void 0,backgroundColor:e.backgroundColor??void 0};return void 0===t.backgroundUrl&&delete t.backgroundUrl,void 0===t.backgroundColor&&delete t.backgroundColor,void 0===t.canvasPreset&&delete t.canvasPreset,void 0===t.canvasWidth&&delete t.canvasWidth,void 0===t.canvasHeight&&delete t.canvasHeight,(await eN.api.put(`${eN.endpoints.template}/${e.businessId}/${e.id}`,t)).data},onSuccess:()=>{l.toast.success("Template updated"),e8(),W(!1),eY();let e=ta.current;e&&(ta.current=null,te.push(e))},onError:e=>l.toast.error(e instanceof Error?e.message:"Failed to update template")}),tc=(0,r.useMutation)({mutationFn:async e=>{await eN.api.delete(`${eN.endpoints.template}/${e.businessId}/${e.id}`)},onMutate:e=>{ea(e.id)},onSuccess:(t,a)=>{l.toast.success("Template deleted"),e?.id===a.id&&(W(!1),i(null)),e8()},onError:e=>{l.toast.error(e instanceof Error?e.message:"Failed to delete template")},onSettled:()=>{ea(null)}}),tu=(e,t)=>{eZ(a=>{a.placeholders[e]&&(a.placeholders[e]={...a.placeholders[e],...t})})},th=e=>{eZ(t=>{Object.assign(t,e)})};(0,a.useEffect)(()=>{if(tt.current)return;let e=e7.get("templateId");if(!e)return;let t=e3.find(t=>t.id===e);if(!t)return;let a=e7.get("content"),r=e7.get("returnTo"),s=r?decodeURIComponent(r):null,l=null;if(a)try{l=JSON.parse(a)}catch{l=null}ts(t,{prefill:l,returnTo:s}),tt.current=!0,te.replace("/dashboard/templates",{scroll:!1})},[te,e7,e3]);let tx=(e,t)=>{let a=null;eZ(r=>{let s,l=r.placeholders.filter(t=>t.type===e).length,d=tI(r.placeholders,`${"text"===e?"text":"image"===e?"image":"shape"}-${l+1}`),n="text"===e?{x:60,y:80+70*l}:{x:140,y:180+150*l},o=r.placeholders.reduce((e,t)=>Math.max(e,t.zIndex??0),0)+1;if("text"===e)s={key:d,type:"text",x:n.x,y:n.y,fontSize:32,color:"#ffffff",maxWidth:320,fontFamily:"Inter",fontWeight:"bold",letterSpacing:0,lineHeight:1.2,opacity:1,rotation:0,locked:!1,zIndex:o};else if("image"===e)s={key:d,type:"image",x:n.x,y:n.y,width:220,height:220,opacity:1,rotation:0,locked:!1,zIndex:o,imageUrl:t?.imageUrl};else{let e=t?.shape??"rectangle";s="circle"===e?{key:d,type:"shape",x:n.x,y:n.y,shape:"circle",width:200,height:200,fillColor:"#f97316",borderColor:"#1e293b",borderWidth:0,borderRadius:void 0,dashPattern:void 0,opacity:1,rotation:0,locked:!1,zIndex:o}:"triangle"===e?{key:d,type:"shape",x:n.x,y:n.y,shape:"triangle",width:260,height:220,fillColor:"#0ea5e9",borderColor:"#0ea5e9",borderWidth:0,borderRadius:void 0,dashPattern:void 0,opacity:1,rotation:0,locked:!1,zIndex:o}:"line"===e?{key:d,type:"shape",x:n.x,y:n.y,shape:"line",width:260,height:6,fillColor:"#3b82f6",borderColor:"#3b82f6",borderWidth:6,borderRadius:void 0,dashPattern:void 0,opacity:1,rotation:0,locked:!1,zIndex:o}:{key:d,type:"shape",x:n.x,y:n.y,shape:"rectangle",width:240,height:160,fillColor:"#60a5fa",borderColor:"#1e293b",borderWidth:2,borderRadius:32,dashPattern:void 0,opacity:1,rotation:0,locked:!1,zIndex:o}}r.placeholders.push(s),a=s.key}),"image"===e&&t?.imageUrl&&a&&e0(a,{imageUrl:t.imageUrl})},tm=e=>{eZ(t=>{let a=t.placeholders[e];if(!a)return;let r=`${a.key}-copy`,s=tI(t.placeholders,r),l={...a,key:s,x:a.x+24,y:a.y+24,locked:!1,opacity:a.opacity??1,rotation:a.rotation??0,dashPattern:a.dashPattern?[...a.dashPattern]:void 0};t.placeholders.splice(e+1,0,l)})},tb=e=>{eZ(t=>{t.placeholders=t.placeholders.filter((t,a)=>a!==e)})},tg=(e,t)=>{eZ(a=>{"up"===t&&e>0&&([a.placeholders[e-1],a.placeholders[e]]=[a.placeholders[e],a.placeholders[e-1]]),"down"===t&&e<a.placeholders.length-1&&([a.placeholders[e+1],a.placeholders[e]]=[a.placeholders[e],a.placeholders[e+1]])})},tp=e=>{eZ(t=>{t.placeholders[e]&&(t.placeholders[e]={...t.placeholders[e],locked:!t.placeholders[e].locked})})},tf=async e=>{let t=await e5(e);t&&(l.toast.success("Background uploaded"),e2(t,e.name),eZ(e=>{e.backgroundUrl=t}))},tk=async(e,t)=>{let a=await e5(t);if(!a)return"";l.toast.success("Image uploaded"),e2(a,t.name);let r=null;return eZ(t=>{let s=t.placeholders[e];s&&(s.imageUrl=a,r=s.key)}),r&&e0(r,{imageUrl:a}),a},tv=async e=>{let t=await e5(e);t&&(e2(t,e.name),l.toast.success("Asset uploaded to library"))},ty=async e=>{if(!navigator?.clipboard?.writeText)return void l.toast.error("Clipboard not available. Copy manually instead.");try{await navigator.clipboard.writeText(e),ed(e),eA.current&&clearTimeout(eA.current),eA.current=setTimeout(()=>ed(null),2e3)}catch{l.toast.error("Clipboard not available. Copy manually instead.")}},tj=(0,a.useMemo)(()=>new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}),[]),tw=(0,a.useMemo)(()=>{let t=new Map,a=(e,a,r)=>{if(!e)return;let s=e.trim();if(!s)return;let l=t.get(s);if(l){l.sources.add(a),r?.uploadedAt&&r.uploadedAt>l.uploadedAt&&(l.uploadedAt=r.uploadedAt),r?.name&&!l.name&&(l.name=r.name);return}t.set(s,{url:s,uploadedAt:r?.uploadedAt??0,name:r?.name??null,sources:new Set([a])})};er.forEach(e=>a(e.url,"library",{uploadedAt:e.uploadedAt,name:e.name??null})),e?.backgroundUrl&&a(e.backgroundUrl,"template-background"),e?.placeholders.forEach(e=>{"image"===e.type&&e.imageUrl&&a(e.imageUrl,"template-placeholder")}),V&&Object.values(V).forEach(e=>{e?.imageUrl&&a(e.imageUrl,"prefill")});let r=new Set(er.map(e=>e.url)),s=e=>e.includes("library")?3:e.includes("template-background")?2:+!!e.includes("template-placeholder");return Array.from(t.values()).map(e=>({url:e.url,uploadedAt:e.uploadedAt,name:((e,t)=>{if(t)return t;try{let t=e.split("/");return decodeURIComponent(t[t.length-1]??e)}catch{return e}})(e.url,e.name),sources:Array.from(e.sources),isLibraryManaged:r.has(e.url)})).sort((e,t)=>{let a=s(t.sources)-s(e.sources);return 0!==a?a:t.uploadedAt-e.uploadedAt})},[er,e,V]),tN=(0,a.useMemo)(()=>{let e=new Set;return e3.forEach(t=>t.emotionFit.forEach(t=>e.add(t))),Array.from(e)},[e3]),tC=(0,a.useMemo)(()=>{if(!H.trim())return e3;let e=H.toLowerCase();return e3.filter(t=>t.name.toLowerCase().includes(e))},[e3,H]);(0,a.useEffect)(()=>{if(P){let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[P]);let tS=e=>{L(t=>Math.max(.2,Math.min(Number(("in"===e?t+.05:t-.05).toFixed(2)),1)))},tM=(0,a.useCallback)(e=>{L(Math.max(.2,Math.min(Number(e.toFixed(3)),1)))},[]),tU=(0,a.useCallback)(e=>{let t=ef(e);t&&(eZ(e=>{e.orientation=t.orientation,e.canvasPreset=t.id,e.canvasWidth=t.width,e.canvasHeight=t.height}),L(Math.max(.2,Math.min(1,Number((420/t.width).toFixed(2))))))},[eZ]),tI=(e,t,a)=>{let r=new Set(e.filter((e,t)=>t!==a).map(e=>e.key));if(!r.has(t))return t;let s=2,l=`${t}-${s}`;for(;r.has(l);)s+=1,l=`${t}-${s}`;return l},tF=e=>{Number.isNaN(e)||ee(Math.min(240,Math.max(5,Math.round(e))))},tP=()=>new Promise(e=>requestAnimationFrame(()=>e())),tT=async t=>{if(!e)return void l.toast.error("Select a template to download.");let a=e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||"template";if("json"===t){let t=new Blob([JSON.stringify({...e,backgroundUrl:e.backgroundUrl??null,backgroundColor:e.backgroundColor??null},null,2)],{type:"application/json"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`${a}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),l.toast.success("Template JSON downloaded");return}let r=eb.current;if(!r)return void l.toast.error("Preview is still loading. Try again in a moment.");G&&(J(!1),await tP());try{let{width:t}=ev({canvasPreset:e.canvasPreset,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,orientation:e.orientation}),s=r.width(),d=s>0?Math.max(1,t/s):Math.max(1,1/Math.max(A,.01)),n=r.toDataURL({pixelRatio:d}),o=document.createElement("a");o.href=n,o.download=`${a}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o),l.toast.success("Template PNG downloaded")}catch(e){console.error("Failed to export template as PNG",e),l.toast.error("Unable to download image. Ensure background assets allow downloads.")}finally{G&&(await tP(),J(!0))}};return(0,a.useCallback)(e=>{if(!e)return;let t={...e};return Object.keys(t).forEach(e=>{t[e].imageUrl&&(t[e].imageUrl=t[e].imageUrl.replace(/^https?:\/\//,""))}),t},[]),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900 dark:text-white",children:"Template builder"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Upload backgrounds, refine placeholders, and give DeepSeek the perfect stage for your copy."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[(0,t.jsxs)(eI.Select,{value:tr||void 0,onValueChange:e=>{if(e===eF.NEW_BUSINESS_ID){eG(eF.NEW_BUSINESS_ID),te.push("/dashboard/business");return}eG(e)},disabled:0===eV.length,children:[(0,t.jsx)(eI.SelectTrigger,{className:"min-w-[220px] rounded-xl border border-slate-200 bg-white text-left text-sm font-medium shadow-sm dark:border-slate-800 dark:bg-slate-900",children:(0,t.jsx)(eI.SelectValue,{placeholder:"Choose a business"})}),(0,t.jsxs)(eI.SelectContent,{align:"end",className:"max-h-80 min-w-[240px]",children:[eV.map(e=>(0,t.jsx)(eI.SelectItem,{value:e.id,children:e.name},e.id)),(0,t.jsx)(eI.SelectItem,{value:eF.NEW_BUSINESS_ID,className:"text-blue-600 focus:text-blue-600",children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.PlusIcon,{className:"h-4 w-4"}),"Create new business"]})})]})]}),(0,t.jsx)(B.Button,{type:"button",variant:"outline",onClick:()=>{eG(eF.NEW_BUSINESS_ID),te.push("/dashboard/business")},children:"Manage businesses"})]})]}),(0,t.jsxs)(eo,{defaultValue:"gallery",className:"space-y-6",children:[(0,t.jsxs)(ei,{className:"grid w-full grid-cols-2 rounded-xl bg-slate-100 p-1 dark:bg-slate-900/40",children:[(0,t.jsx)(ec,{value:"gallery",children:"Gallery"}),(0,t.jsx)(ec,{value:"create",children:"Create new"})]}),(0,t.jsx)(eu,{value:"gallery",className:"space-y-4",children:eJ?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-2 text-xs text-slate-500",children:tN.map(e=>(0,t.jsx)(ex.EmotionBadge,{emotion:e},e))}),e9?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:3}).map((e,a)=>(0,t.jsx)(eU.Skeleton,{className:"h-72 rounded-3xl"},a))}):tC.length?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:tC.map(e=>(0,t.jsx)(ey,{template:e,onEdit:e=>{ts(e)},onUse:()=>{l.toast.info("Template will be applied on the next AI generation run.")},onDelete:a=>{l.toast.custom(e=>(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("p",{className:"text-sm font-medium",children:['Delete "',a.name,'"?']}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"This removes the template permanently. Any posts already using it will need a new template."}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(B.Button,{variant:"ghost",size:"sm",onClick:()=>l.toast.dismiss(e),children:"Cancel"}),(0,t.jsxs)(B.Button,{size:"sm",className:"bg-red-600 text-white hover:bg-red-700",onClick:()=>{l.toast.dismiss(e),tc.mutate(a)},disabled:tc.isPending&&et===a.id,children:[(0,t.jsx)(F.Trash2,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}),{id:`confirm-delete-${e.id}`,duration:1e4})},isDeleting:tc.isPending&&et===e.id},e.id))}):(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 text-sm text-slate-500 dark:border-slate-800 dark:bg-slate-900/50 dark:text-slate-300",children:'No templates yet. Use the "Create new" tab to design the first template for this business.'})]}):(0,t.jsx)("div",{className:"rounded-2xl border border-dashed border-slate-300 bg-slate-50 p-6 text-sm text-slate-600 dark:border-slate-700 dark:bg-slate-900/40 dark:text-slate-300",children:"Select or create a business to view its template library."})}),(0,t.jsx)(eu,{value:"create",children:(0,t.jsxs)(D.Card,{className:"border-slate-200 shadow-sm dark:border-slate-800",children:[(0,t.jsxs)(D.CardHeader,{children:[(0,t.jsx)(D.CardTitle,{children:"Create a template"}),(0,t.jsx)(D.CardDescription,{children:eJ?`Templates created here will be tied to ${eJ.name}.`:"Choose a business to enable template creation."})]}),(0,t.jsx)(D.CardContent,{children:eJ?(0,t.jsx)(eh.Form,{...tl,children:(0,t.jsxs)("form",{onSubmit:tl.handleSubmit(e=>to.mutate(e)),className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsx)(eh.FormField,{control:tl.control,name:"name",render:({field:e})=>(0,t.jsxs)(eh.FormItem,{children:[(0,t.jsx)(eh.FormLabel,{children:"Template name"}),(0,t.jsx)(eh.FormControl,{children:(0,t.jsx)(R.Input,{placeholder:"Story - Bold announcement",...e})}),(0,t.jsx)(eh.FormMessage,{})]})}),(0,t.jsx)(eh.FormField,{control:tl.control,name:"canvasPreset",render:({field:e})=>(0,t.jsxs)(eh.FormItem,{children:[(0,t.jsx)(eh.FormLabel,{children:"Canvas preset"}),(0,t.jsxs)(eI.Select,{value:e.value,onValueChange:e.onChange,children:[(0,t.jsx)(eh.FormControl,{children:(0,t.jsx)(eI.SelectTrigger,{className:"w-full",children:(0,t.jsx)(eI.SelectValue,{placeholder:"Choose a preset"})})}),(0,t.jsx)(eI.SelectContent,{align:"start",className:"max-h-80 min-w-[18rem]",children:eg.map(e=>(0,t.jsx)(eI.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex flex-col text-left",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-slate-800 dark:text-slate-100",children:e.label}),e.description?(0,t.jsx)("span",{className:"text-xs text-slate-500",children:e.description}):null]})},e.id))})]}),tn?(0,t.jsxs)("p",{className:"text-xs text-slate-500",children:[ek(tn.width,tn.height)," • ",tn.orientation.toUpperCase()]}):null,(0,t.jsx)(eh.FormMessage,{})]})}),(0,t.jsx)(eh.FormField,{control:tl.control,name:"tags",render:({field:e})=>(0,t.jsxs)(eh.FormItem,{className:"md:col-span-2",children:[(0,t.jsx)(eh.FormLabel,{children:"Tags"}),(0,t.jsx)(eh.FormControl,{children:(0,t.jsx)(R.Input,{placeholder:"social, promo, instagram",...e})}),(0,t.jsx)(eh.FormMessage,{})]})}),(0,t.jsx)(eh.FormField,{control:tl.control,name:"emotionFit",render:({field:e})=>(0,t.jsxs)(eh.FormItem,{className:"md:col-span-2",children:[(0,t.jsx)(eh.FormLabel,{children:"Emotion fit"}),(0,t.jsx)(eh.FormControl,{children:(0,t.jsx)(R.Input,{placeholder:"joy, trust",...e})}),(0,t.jsx)(eh.FormMessage,{})]})}),(0,t.jsxs)(B.Button,{type:"submit",className:"bg-blue-600 text-white hover:bg-blue-700",disabled:!eJ||to.isPending,children:[to.isPending?(0,t.jsx)(b.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(p.PlusIcon,{className:"mr-2 h-4 w-4"}),"Save template"]})]})}):(0,t.jsx)("div",{className:"rounded-2xl border border-dashed border-slate-300 bg-slate-50 p-6 text-sm text-slate-600 dark:border-slate-700 dark:bg-slate-900/40 dark:text-slate-300",children:"Select or create a business to start designing templates."})})]})})]}),P?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-50",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4 dark:border-slate-900",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-600 text-lg font-semibold text-white dark:text-slate-50",children:"AI"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:"Template Editor"}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:e?.name??"Template preview"})]}),e&&eK?(0,t.jsxs)("div",{className:"flex flex-col items-start gap-1",children:[(0,t.jsx)(E.Badge,{variant:"outline",className:"rounded-full border-slate-300 bg-slate-100 px-3 py-1 text-xs font-semibold tracking-wide text-slate-700 dark:border-slate-800 dark:bg-slate-950/60 dark:text-slate-200",children:ek(eK.width,eK.height)}),eK.preset?(0,t.jsx)("span",{className:"text-xs uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400",children:eK.preset.label.split(" (")[0]}):null]}):null]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",onClick:e6,disabled:!e_.canUndo,title:e_.canUndo?"Undo last change":"Nothing to undo",children:(0,t.jsx)(w,{className:"h-4 w-4"})}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",onClick:e4,disabled:!e_.canRedo,title:e_.canRedo?"Redo last undo":"Nothing to redo",children:(0,t.jsx)(f,{className:"h-4 w-4"})}),(0,t.jsxs)(em.DropdownMenu,{children:[(0,t.jsx)(em.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",disabled:!e,title:"Download template",children:(0,t.jsx)(o.Download,{className:"h-4 w-4"})})}),(0,t.jsxs)(em.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsx)(em.DropdownMenuItem,{disabled:!e,onClick:()=>void tT("png"),children:"Download as PNG"}),(0,t.jsx)(em.DropdownMenuItem,{disabled:!e,onClick:()=>void tT("json"),children:"Download as JSON"})]})]}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>W(!1),children:(0,t.jsx)(S.default,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"flex flex-1 overflow-hidden bg-slate-50 dark:bg-slate-950",children:[(0,t.jsxs)("aside",{className:"hidden w-20 flex-col items-center gap-6 border-r border-slate-200 bg-slate-100 py-6 lg:flex dark:border-slate-900 dark:bg-slate-950/80",children:[(0,t.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-slate-200 text-slate-600 shadow-inner dark:bg-slate-900 dark:text-slate-200",children:(0,t.jsx)(g,{className:"h-5 w-5"})}),(0,t.jsxs)("nav",{className:"flex flex-1 flex-col items-center gap-4 text-xs font-medium text-slate-500 dark:text-slate-400",children:[(0,t.jsx)("button",{className:(0,en.cn)("flex h-10 w-10 items-center justify-center rounded-xl bg-slate-200 text-slate-600 transition hover:bg-slate-300 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800","templates"===_&&"bg-blue-600 text-white shadow-lg shadow-blue-500/20 hover:bg-blue-600 dark:bg-blue-600 dark:text-white"),onClick:()=>O(e=>"templates"===e?null:"templates"),children:(0,t.jsx)(x,{className:"h-5 w-5"})}),(0,t.jsx)("button",{className:(0,en.cn)("flex h-10 w-10 items-center justify-center rounded-xl bg-slate-200 text-slate-600 transition hover:bg-slate-300 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800","text"===_&&"bg-blue-600 text-white shadow-lg shadow-blue-500/20 hover:bg-blue-600 dark:bg-blue-600 dark:text-white"),onClick:()=>O(e=>"text"===e?null:"text"),children:(0,t.jsx)(j,{className:"h-5 w-5"})}),(0,t.jsx)("button",{className:(0,en.cn)("flex h-10 w-10 items-center justify-center rounded-xl bg-slate-200 text-slate-600 transition hover:bg-slate-300 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800","elements"===_&&"bg-blue-600 text-white shadow-lg shadow-blue-500/20 hover:bg-blue-600 dark:bg-blue-600 dark:text-white"),onClick:()=>O(e=>"elements"===e?null:"elements"),children:(0,t.jsx)(y,{className:"h-5 w-5"})}),(0,t.jsx)("button",{className:(0,en.cn)("flex h-10 w-10 items-center justify-center rounded-xl bg-slate-200 text-slate-600 transition hover:bg-slate-300 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800","images"===_&&"bg-blue-600 text-white shadow-lg shadow-blue-500/20 hover:bg-blue-600 dark:bg-blue-600 dark:text-white"),onClick:()=>O(e=>"images"===e?null:"images"),children:(0,t.jsx)(h,{className:"h-5 w-5"})}),(0,t.jsx)("button",{className:(0,en.cn)("flex h-10 w-10 items-center justify-center rounded-xl bg-slate-200 text-slate-600 transition hover:bg-slate-300 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800","uploads"===_&&"bg-blue-600 text-white shadow-lg shadow-blue-500/20 hover:bg-blue-600 dark:bg-blue-600 dark:text-white"),onClick:()=>O(e=>"uploads"===e?null:"uploads"),children:(0,t.jsx)(u,{className:"h-5 w-5"})})]})]}),(0,t.jsxs)("aside",{className:(0,en.cn)("hidden flex-col bg-white transition-[width,opacity] duration-200 ease-out md:flex dark:bg-slate-950/60",_?"w-80 border-r border-slate-200 opacity-100 dark:border-slate-900":"w-0 border-r-0 opacity-0 pointer-events-none"),children:["templates"===_&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"border-b border-slate-200 px-5 py-5 dark:border-slate-900",children:(0,t.jsxs)("div",{className:"flex items-center rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500 shadow-inner dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300",children:[(0,t.jsx)(v.default,{className:"mr-2 h-4 w-4 text-slate-400 dark:text-slate-500"}),(0,t.jsx)("input",{type:"search",value:H,onChange:e=>$(e.target.value),placeholder:"Search templates...",className:"flex-1 bg-transparent text-sm text-slate-600 placeholder:text-slate-400 focus:outline-none dark:text-slate-200 dark:placeholder:text-slate-500"})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-5 py-5",children:(0,t.jsx)("div",{className:"grid gap-4",children:tC.length?tC.map(a=>(0,t.jsxs)("button",{type:"button",onClick:()=>{let e;return eY(),e=Math.max(.2,Math.min(1,Number((420/ev({canvasPreset:a.canvasPreset,canvasWidth:a.canvasWidth,canvasHeight:a.canvasHeight,orientation:a.orientation}).width).toFixed(2)))),void(i({...a,backgroundUrl:a.backgroundUrl??void 0,backgroundColor:a.backgroundColor??void 0}),L(e),q(null))},className:(0,en.cn)("group overflow-hidden rounded-2xl border border-slate-200 bg-slate-100 p-3 text-left transition hover:border-blue-400/60 hover:bg-slate-50 dark:border-transparent dark:bg-slate-900/60 dark:hover:border-blue-500/40 dark:hover:bg-slate-900",e?.id===a.id?"border-blue-500/60 dark:border-blue-500/60":""),children:[(0,t.jsx)("div",{className:"relative h-32 w-full overflow-hidden rounded-xl border border-slate-200 bg-slate-200 dark:border-slate-900/60 dark:bg-slate-900",children:a.backgroundUrl?(0,t.jsx)(T.default,{src:a.backgroundUrl,alt:a.name,fill:!0,className:"object-cover transition group-hover:scale-105",sizes:"(min-width: 768px) 320px, 100vw",unoptimized:!0}):(0,t.jsx)("div",{className:"flex h-full items-center justify-center text-xs uppercase tracking-[0.18em] text-slate-500",children:"No background"})}),(0,t.jsx)("p",{className:"mt-3 text-sm font-medium text-slate-700 dark:text-slate-100",children:a.name}),(0,t.jsx)("p",{className:"text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-500",children:a.orientation})]},a.id)):(0,t.jsx)("p",{className:"px-1 text-xs text-slate-500",children:"No templates match that search."})})})]}),"text"===_&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-5 py-5",children:(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Text placeholders"}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>tx("text"),children:(0,t.jsx)(p.PlusIcon,{className:"h-4 w-4"})})]}),e?(0,t.jsx)(ej.TemplatePlaceholderList,{template:e,onChange:tu,filterType:"text",onTypeToggle:e=>"image"===e&&O("images"),onDuplicate:tm,onDelete:tb,onReorder:tg,onLockToggle:tp,content:V??void 0,onContentUpdate:e0,onContentRename:e1}):(0,t.jsx)("div",{className:"space-y-2",children:Array.from({length:3}).map((e,a)=>(0,t.jsx)(eU.Skeleton,{className:"h-16 rounded-xl bg-slate-200 dark:bg-slate-900/60"},a))})]})}),"images"===_&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-5 py-5",children:(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900/60",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Frame border"}),(0,t.jsx)("input",{type:"color",value:e?.frameBorderColor??"#ffffff",onChange:e=>th({frameBorderColor:e.target.value}),className:"h-9 w-9 cursor-pointer rounded-full border border-slate-300 bg-white shadow-sm dark:border-slate-700"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-slate-600",children:"Border width"}),(0,t.jsx)("input",{type:"number",min:"0",max:"40",value:e?.frameBorderWidth??0,onChange:e=>th({frameBorderWidth:Math.max(0,parseInt(e.target.value)||0)}),className:"w-full rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm shadow-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900"})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-slate-600",children:"Border radius"}),(0,t.jsx)("input",{type:"number",min:"0",max:"200",value:e?.frameBorderRadius??0,onChange:e=>th({frameBorderRadius:Math.max(0,parseInt(e.target.value)||0)}),className:"w-full rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm shadow-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900/60",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Background"}),(0,t.jsx)("div",{className:"flex flex-col gap-3 rounded-xl border border-slate-200 bg-white p-3 dark:border-slate-800 dark:bg-slate-950/60",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"color",value:e?.backgroundColor??eT,onChange:e=>{var t;return t=e.target.value,void(/^#([0-9a-fA-F]{3}){1,2}$/.test(t)&&eZ(e=>{e.backgroundColor=t.toLowerCase()}))},className:"h-10 w-10 cursor-pointer rounded-lg border border-slate-200 bg-transparent p-0 dark:border-slate-700"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Fallback color"}),(0,t.jsx)("span",{className:"font-mono text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:(e?.backgroundColor??eT).toUpperCase()})]})]}),(0,t.jsx)(B.Button,{variant:"ghost",size:"sm",className:"h-8 rounded-full border border-slate-200 text-xs text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800",onClick:()=>{eZ(e=>{e.backgroundColor=eT})},children:"Use default"})]})}),(0,t.jsx)(ew.FileUpload,{label:"Upload PNG background",onUpload:tf,accept:["image/png","image/jpeg","image/webp"]}),e?.backgroundUrl?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Current background"}),(0,t.jsx)("div",{className:"relative overflow-hidden rounded-2xl border border-slate-200 bg-slate-100 dark:border-slate-800 dark:bg-slate-900",children:(0,t.jsx)("div",{className:"relative h-48 w-full",children:(0,t.jsx)(T.default,{src:e.backgroundUrl,alt:"Template background",fill:!0,className:"object-cover",sizes:"(min-width: 768px) 320px, 100vw",unoptimized:!0,priority:!0})})}),(0,t.jsx)("p",{className:"break-all text-[11px] text-slate-500",children:e.backgroundUrl}),(0,t.jsx)(B.Button,{variant:"ghost",size:"sm",className:"h-8 rounded-full border border-slate-200 text-xs text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800",onClick:()=>{eZ(e=>{e.backgroundUrl=void 0})},children:"Remove background image"})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"No background image selected. The fallback color will be used when rendering this template."}),(0,t.jsx)("div",{className:"h-20 rounded-2xl border border-dashed border-slate-300 shadow-inner dark:border-slate-700",style:{background:e?.backgroundColor??eT}})]})]}),(0,t.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900/60",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Image placeholders"}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>tx("image"),children:(0,t.jsx)(p.PlusIcon,{className:"h-4 w-4"})})]}),e?(0,t.jsx)(ej.TemplatePlaceholderList,{template:e,onChange:tu,filterType:"image",onTypeToggle:e=>"text"===e&&O("text"),onImageUpload:tk,onDuplicate:tm,onDelete:tb,onReorder:tg,onLockToggle:tp,content:V??void 0,onContentUpdate:e0,onContentRename:e1}):(0,t.jsx)("div",{className:"space-y-2",children:Array.from({length:2}).map((e,a)=>(0,t.jsx)(eU.Skeleton,{className:"h-16 rounded-xl bg-slate-200 dark:bg-slate-900/60"},a))})]})]})}),"elements"===_&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-5 py-5",children:(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-4 rounded-2xl border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900/60",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Shapes"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(B.Button,{variant:"outline",size:"sm",className:"rounded-xl border-slate-300 bg-white text-slate-700 hover:border-blue-400 hover:bg-blue-500/10 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-blue-500 dark:hover:bg-blue-500/20",onClick:()=>tx("shape",{shape:"rectangle"}),children:"Add rectangle"}),(0,t.jsx)(B.Button,{variant:"outline",size:"sm",className:"rounded-xl border-slate-300 bg-white text-slate-700 hover:border-blue-400 hover:bg-blue-500/10 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-blue-500 dark:hover:bg-blue-500/20",onClick:()=>tx("shape",{shape:"circle"}),children:"Add circle"}),(0,t.jsx)(B.Button,{variant:"outline",size:"sm",className:"rounded-xl border-slate-300 bg-white text-slate-700 hover:border-blue-400 hover:bg-blue-500/10 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-blue-500 dark:hover:bg-blue-500/20",onClick:()=>tx("shape",{shape:"triangle"}),children:"Add triangle"}),(0,t.jsx)(B.Button,{variant:"outline",size:"sm",className:"rounded-xl border-slate-300 bg-white text-slate-700 hover:border-blue-400 hover:bg-blue-500/10 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-blue-500 dark:hover:bg-blue-500/20",onClick:()=>tx("shape",{shape:"line"}),children:"Add line"})]})]}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Layer shapes (rectangles, circles, triangles, lines) to build backgrounds, callouts, and accents. Use the list below to fine tune styling, order, and locking."})]}),e?(0,t.jsx)(ej.TemplatePlaceholderList,{template:e,onChange:tu,filterType:"shape",onDuplicate:tm,onDelete:tb,onReorder:tg,onLockToggle:tp,content:V??void 0,onContentUpdate:e0,onContentRename:e1}):(0,t.jsx)("div",{className:"space-y-2",children:Array.from({length:2}).map((e,a)=>(0,t.jsx)(eU.Skeleton,{className:"h-16 rounded-xl bg-slate-200 dark:bg-slate-900/60"},a))})]})}),"uploads"===_&&(0,t.jsxs)("div",{className:"flex h-full flex-1 flex-col gap-5 overflow-y-auto px-5 py-5",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Asset uploads"}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Drop branded imagery to reuse it across backgrounds and image placeholders."}),(0,t.jsx)(ew.FileUpload,{label:"Upload brand asset",onUpload:tv,accept:["image/png","image/jpeg","image/webp"]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Library"}),(0,t.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:[tw.length," asset",1===tw.length?"":"s"]})]}),tw.length?(0,t.jsx)("div",{className:"grid gap-3",children:tw.map(a=>(0,t.jsxs)("div",{className:"space-y-3 rounded-2xl border border-slate-200 bg-white p-3 shadow-sm transition hover:border-blue-500/40 hover:shadow-lg dark:border-slate-800 dark:bg-slate-950/60 dark:hover:border-blue-400/40",children:[(0,t.jsx)("div",{className:"relative h-32 w-full overflow-hidden rounded-xl border border-slate-200 bg-slate-100 dark:border-slate-800 dark:bg-slate-900",children:(0,t.jsx)(T.default,{src:a.url,alt:a.name,fill:!0,className:"object-cover",sizes:"(min-width: 768px) 320px, 100vw",unoptimized:!0})}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:a.sources.map(e=>(0,t.jsx)(E.Badge,{variant:"outline",className:"border-slate-200 text-[10px] uppercase tracking-wider text-slate-500 dark:border-slate-700 dark:text-slate-400",children:eD[e]},`${a.url}-${e}`))}),a.uploadedAt?(0,t.jsx)("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:tj.format(new Date(a.uploadedAt))}):null]}),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("p",{className:"truncate font-medium text-slate-700 dark:text-slate-200",title:a.name,children:a.name}),(0,t.jsx)("p",{className:"truncate text-slate-500 dark:text-slate-400",title:a.url,children:a.url})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(B.Button,{size:"sm",variant:"outline",className:"flex-1 border-slate-200 text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>{var t;return t=a.url,void(!e?l.toast.error("Select a template before updating the background."):(e2(t),eZ(e=>{e.backgroundUrl=t}),l.toast.success("Background updated"),O("images")))},children:"Use as background"}),(0,t.jsx)(B.Button,{size:"sm",variant:"outline",className:"flex-1 border-slate-200 text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>{var t;return t=a.url,void(!e?l.toast.error("Select a template before adding placeholders."):(e2(t),tx("image",{imageUrl:t}),l.toast.success("Image placeholder added"),O("images")))},children:"Add image layer"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full border border-slate-200 text-slate-500 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800",onClick:()=>ty(a.url),title:"Copy URL",children:el===a.url?(0,t.jsx)(d.default,{className:"h-4 w-4"}):(0,t.jsx)(n.Copy,{className:"h-4 w-4"})}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full border border-slate-200 text-slate-500 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800",onClick:()=>{var e;return e=a.url,void window.open(e,"_blank","noopener,noreferrer")},title:"Open in new tab",children:(0,t.jsx)(c,{className:"h-4 w-4"})}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full border border-slate-200 text-slate-500 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800 disabled:opacity-40",onClick:()=>{var e;return e=a.url,void es(t=>t.some(t=>t.url===e)?(l.toast.success("Removed from library"),t.filter(t=>t.url!==e)):t)},disabled:!a.isLibraryManaged,title:a.isLibraryManaged?"Remove from library":"Managed by template",children:(0,t.jsx)(F.Trash2,{className:"h-4 w-4"})})]})]},a.url))}):(0,t.jsxs)("div",{className:"flex h-48 flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-slate-300 bg-slate-50 text-center text-xs text-slate-500 dark:border-slate-800 dark:bg-slate-900/60 dark:text-slate-400",children:[(0,t.jsx)(u,{className:"h-6 w-6 text-slate-400"}),(0,t.jsx)("p",{className:"max-w-[16rem]",children:"Store your brand visuals here to reuse them across templates."})]})]})]})]}),(0,t.jsxs)("main",{className:"flex flex-1 flex-col overflow-hidden bg-white dark:bg-slate-950",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-200 px-8 py-4 dark:border-slate-900",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm text-slate-600 dark:text-slate-300",children:[(0,t.jsx)("span",{className:"rounded-full bg-blue-500/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-blue-600 dark:text-blue-300",children:"Preview"}),(0,t.jsx)("span",{children:e?.name??"Select a template"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[e?(0,t.jsxs)(eI.Select,{value:eQ,onValueChange:tU,children:[(0,t.jsx)(eI.SelectTrigger,{className:"rounded-full border border-slate-300 bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800 md:min-w-[220px]",children:(0,t.jsx)(eI.SelectValue,{placeholder:"Select size"})}),(0,t.jsx)(eI.SelectContent,{align:"end",className:"max-h-80 min-w-[20rem]",children:eg.map(e=>(0,t.jsx)(eI.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex flex-col text-left",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-slate-800 dark:text-slate-100",children:e.label}),e.description?(0,t.jsx)("span",{className:"text-xs text-slate-500",children:e.description}):null]})},e.id))})]}):null,(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>tS("out"),children:(0,t.jsx)(C,{className:"h-4 w-4"})}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",onClick:()=>tS("in"),children:(0,t.jsx)(N,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"rounded-full border border-slate-300 bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600 dark:border-slate-800/60 dark:bg-slate-900/50 dark:text-slate-300",children:[Math.round(100*A),"%"]}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:(0,en.cn)("h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",K&&"border-blue-500 bg-blue-500/10 text-blue-600 hover:bg-blue-500/20 dark:text-blue-300"),onClick:()=>Q(e=>!e),title:K?"Hide grid":"Show grid",children:(0,t.jsx)(m,{className:"h-4 w-4"})}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:(0,en.cn)("h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",X&&"border-blue-500 bg-blue-500/10 text-blue-600 hover:bg-blue-500/20 dark:text-blue-300"),onClick:()=>Y(e=>!e),title:X?"Disable snap to grid":"Enable snap to grid",children:(0,t.jsx)(M,{className:"h-4 w-4"})}),(0,t.jsx)(B.Button,{variant:"ghost",size:"icon",className:(0,en.cn)("h-9 w-9 rounded-full border border-slate-300 bg-slate-100 text-slate-500 hover:bg-slate-200 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-200 dark:hover:bg-slate-800",G&&"border-blue-500 bg-blue-500/10 text-blue-600 hover:bg-blue-500/20 dark:text-blue-300"),onClick:()=>J(e=>!e),title:G?"Hide placeholder guides":"Show placeholder guides",children:G?(0,t.jsx)(U,{className:"h-4 w-4"}):(0,t.jsx)(I,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-full border border-slate-300 bg-slate-100 px-3 py-1 text-xs text-slate-600 dark:border-slate-800/60 dark:bg-slate-900/60 dark:text-slate-300",children:[(0,t.jsx)("span",{children:"Grid"}),(0,t.jsx)(R.Input,{type:"number",min:5,max:240,value:Z,onChange:e=>tF(Number(e.target.value)),onBlur:e=>tF(Number(e.target.value)),className:"h-7 w-16 rounded-full border-0 bg-transparent p-0 text-center text-xs focus-visible:ring-0"})]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-hidden px-8 py-8",children:(0,t.jsx)("div",{className:"flex h-full min-h-[360px] items-center justify-center bg-transparent",children:e?(0,t.jsx)(ej.TemplateCanvas,{template:e,onPlaceholderUpdate:(e,t)=>{let a=()=>e.map(e=>({...e,dashPattern:e.dashPattern?[...e.dashPattern]:void 0}));if(t?.recordHistory===!1){let e=!1;i(t=>{if(!t)return t;let r=a(),s={...t,placeholders:r};return eW(t,s)?t:(e$.current||(e$.current=eR(t)),e=!0,s)}),e&&(eH.current.length>0&&(eH.current=[]),eX());return}let r=!1;i(e=>{if(!e)return e;let t=a(),s={...e,placeholders:t};if(eW(e,s))return e$.current=null,e;let l=e$.current??eR(e);return eL.current.push(l),eL.current.length>50&&eL.current.shift(),e$.current=null,eH.current=[],r=!0,s}),r&&eX()},className:"w-full",scale:A,content:V??void 0,showPlaceholderGuides:G,showGrid:K,snapToGrid:X,gridSize:Z,onStageReady:e=>{eb.current=e},onScaleChange:tM}):(0,t.jsx)(eU.Skeleton,{className:"h-[360px] w-full rounded-[2rem] bg-slate-200 dark:bg-slate-900/60"})})})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3 border-t border-slate-200 bg-white px-8 py-4 dark:border-slate-900 dark:bg-slate-950",children:[(0,t.jsx)(B.Button,{variant:"outline",onClick:()=>W(!1),className:"border-slate-300 text-slate-600 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-900",children:"Cancel"}),(0,t.jsxs)(B.Button,{className:"bg-blue-600 text-white hover:bg-blue-700",disabled:!e||ti.isPending,onClick:()=>e&&ti.mutate(e),children:[ti.isPending?(0,t.jsx)(b.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(k,{className:"mr-2 h-4 w-4"}),"Save changes"]})]})]}):null]})}function eL(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"p-6 text-sm text-slate-500",children:"Loading templates…"}),children:(0,t.jsx)(eA,{})})}e.s(["default",()=>eL],56433)}]);